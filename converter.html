<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Image Converter</title>
    <style>
        body { background: #1e1e1e; color: #d4d4d4; font-family: sans-serif; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .container { width: 100%; max-width: 600px; }
        .control-panel { background: #252526; padding: 20px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #3e3e42; }
        label { display: block; margin-bottom: 10px; }
        select, input[type="range"] { background: #3c3c3c; color: white; border: 1px solid #555; padding: 5px; border-radius: 3px; width: 100%; box-sizing: border-box; }
        .btn { background: #007acc; color: white; border: none; padding: 12px; width: 100%; border-radius: 4px; cursor: pointer; margin-top: 10px; font-size: 16px; }
        .btn:hover { background: #0062a3; }
        .list { margin-top: 20px; }
        .item { background: #252526; padding: 10px; margin-bottom: 5px; display: flex; justify-content: space-between; align-items: center; border-radius: 4px; }
        .download-link { color: #007acc; text-decoration: none; border: 1px solid #007acc; padding: 2px 8px; border-radius: 3px; }
        h1 a { text-decoration: none; color: #888; margin-right: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <h1><a href="index.html">←</a> Batch Converter</h1>
        
        <div class="control-panel">
            <label>1. Выбери формат выхода:
                <select id="format">
                    <option value="image/webp">WebP (Для веба / Игр)</option>
                    <option value="image/jpeg">JPEG (Фото)</option>
                    <option value="image/png">PNG (Спрайты)</option>
                </select>
            </label>
            <label>2. Качество (0.1 - 1.0):
                <input type="range" id="quality" min="0.1" max="1" step="0.1" value="0.9">
            </label>
            <label>3. Загрузи файлы:
                <input type="file" id="files" multiple accept="image/*" style="margin-top:5px;">
            </label>
        </div>

        <div class="list" id="resultList"></div>
    </div>

    <script>
        document.getElementById('files').addEventListener('change', async (e) => {
            const files = e.target.files;
            const format = document.getElementById('format').value;
            const quality = parseFloat(document.getElementById('quality').value);
            const list = document.getElementById('resultList');
            list.innerHTML = '';

            for (let file of files) {
                const item = document.createElement('div');
                item.className = 'item';
                item.innerHTML = `<span>⏳ ${file.name}...</span>`;
                list.appendChild(item);

                try {
                    const blob = await convertImage(file, format, quality);
                    const ext = format.split('/')[1];
                    const newName = file.name.split('.')[0] + '.' + ext;
                    
                    const url = URL.createObjectURL(blob);
                    item.innerHTML = `
                        <span>✅ ${newName}</span>
                        <a href="${url}" download="${newName}" class="download-link">Скачать</a>
                    `;
                } catch (err) {
                    item.innerHTML = `<span style="color:red">Ошибка: ${file.name}</span>`;
                    console.error(err);
                }
            }
        });

        function convertImage(file, format, quality) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    canvas.width = img.width;
                    canvas.height = img.height;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0);
                    canvas.toBlob(blob => resolve(blob), format, quality);
                };
                img.onerror = reject;
                img.src = URL.createObjectURL(file);
            });
        }
    </script>
</body>
</html>

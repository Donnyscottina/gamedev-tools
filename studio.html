<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Gamedev Studio OS</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    body {
      overflow: hidden;
      background: #111;
      background-image: 
        linear-gradient(rgba(156, 255, 138, 0.05) 1px, transparent 1px),
        linear-gradient(90deg, rgba(156, 255, 138, 0.05) 1px, transparent 1px);
      background-size: 40px 40px;
    }

    /* Desktop Area */
    #desktop {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 48px;
      overflow: hidden;
    }

    /* Window Styles */
    .window {
      position: absolute;
      background: #1a1a1a;
      border: 1px solid #444;
      border-radius: 6px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.5);
      display: flex;
      flex-direction: column;
      min-width: 300px;
      min-height: 200px;
      resize: both; /* native resize handle */
      overflow: hidden;
      animation: popIn 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    .window.active {
      border-color: var(--accent);
      z-index: 100;
      box-shadow: 0 15px 40px rgba(0,0,0,0.7);
    }

    @keyframes popIn { from { transform: scale(0.95); opacity: 0; } to { transform: scale(1); opacity: 1; } }

    .title-bar {
      height: 32px;
      background: #222;
      border-bottom: 1px solid #333;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 10px;
      cursor: grab;
      user-select: none;
    }
    .title-bar:active { cursor: grabbing; }
    .window.active .title-bar { background: #2a2a2a; color: #fff; }

    .win-title {
      font-family: 'Press Start 2P', monospace;
      font-size: 10px;
      color: #aaa;
      pointer-events: none;
    }
    .window.active .win-title { color: var(--accent); }

    .win-controls { display: flex; gap: 8px; }
    .win-btn {
      width: 12px; height: 12px; border-radius: 50%;
      border: none; cursor: pointer;
    }
    .win-btn.close { background: #ff5555; }
    .win-btn.max { background: #ffcc66; }
    .win-btn.min { background: #55ff55; }
    .win-btn:hover { filter: brightness(1.2); }

    .win-content {
      flex: 1;
      position: relative;
      background: #000;
    }
    
    /* Iframe overlay to prevent mouse capture during drag */
    .drag-overlay {
      position: absolute; top:0; left:0; right:0; bottom:0;
      display: none; z-index: 999;
    }
    .window.dragging .drag-overlay { display: block; }

    iframe {
      width: 100%; height: 100%; border: none;
      display: block;
    }

    /* Taskbar */
    #taskbar {
      position: absolute;
      bottom: 0; left: 0; right: 0;
      height: 48px;
      background: rgba(26, 26, 26, 0.95);
      border-top: 1px solid #333;
      display: flex;
      align-items: center;
      padding: 0 10px;
      gap: 10px;
      backdrop-filter: blur(5px);
      z-index: 10000;
    }

    .start-btn {
      font-family: 'Press Start 2P', monospace;
      background: var(--accent);
      color: #000;
      border: none;
      padding: 0 16px;
      height: 32px;
      border-radius: 4px;
      font-size: 12px;
      cursor: pointer;
      font-weight: bold;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .start-btn:hover { filter: brightness(1.1); }
    .start-btn:active { transform: translateY(1px); }

    .task-divider { width: 1px; height: 24px; background: #444; margin: 0 5px; }

    .task-item {
      background: #333;
      color: #ccc;
      padding: 0 12px;
      height: 32px;
      display: flex;
      align-items: center;
      border-radius: 4px;
      font-size: 12px;
      cursor: pointer;
      user-select: none;
      border-bottom: 2px solid transparent;
      transition: all 0.2s;
    }
    .task-item:hover { background: #444; color: #fff; }
    .task-item.active {
      background: #2a2a2a;
      color: var(--accent);
      border-bottom-color: var(--accent);
    }
    
    /* Start Menu */
    #start-menu {
      position: absolute;
      bottom: 54px;
      left: 10px;
      width: 250px;
      background: #1a1a1a;
      border: 1px solid #444;
      border-radius: 6px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.5);
      display: none;
      flex-direction: column;
      padding: 6px;
      z-index: 10001;
    }
    #start-menu.open { display: flex; }

    .menu-item {
      padding: 10px 12px;
      color: #ddd;
      cursor: pointer;
      border-radius: 4px;
      font-size: 13px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .menu-item:hover { background: var(--accent); color: #000; }
    .menu-item span { font-size: 16px; }

  </style>
</head>
<body>

  <div id="desktop"></div>

  <div id="start-menu">
    <div class="menu-item" onclick="openApp('pixelart.html', 'Pixel Art Pro', '‚úèÔ∏è', 1000, 700)">
      <span>‚úèÔ∏è</span> Pixel Art Editor
    </div>
    <div class="menu-item" onclick="openApp('soundmaker.html', 'SoundMaker', 'üéπ', 920, 500)">
      <span>üéπ</span> SoundMaker Pro
    </div>
    <div class="menu-item" onclick="openApp('sfx.html', 'SFX Gen', 'üîä', 800, 600)">
      <span>üîä</span> SFX Generator
    </div>
    <div class="menu-item" onclick="openApp('ui-theme-generator.html', 'UI Themer', 'üé®', 900, 600)">
      <span>üé®</span> UI Theme Gen
    </div>
    <div class="menu-item" onclick="openApp('paletteremapper.html', 'Remapper', 'üåà', 850, 600)">
      <span>üåà</span> Palette Remapper
    </div>
    <div style="height:1px; background:#333; margin:4px 0"></div>
    <div class="menu-item" onclick="window.location.href='index.html'">
      <span>üö™</span> Exit to Hub
    </div>
  </div>

  <div id="taskbar">
    <button class="start-btn" onclick="toggleStart()">üëæ START</button>
    <div class="task-divider"></div>
    <div id="tasks-area" style="display:flex; gap:6px;"></div>
    
    <div style="margin-left:auto; font-size:11px; color:#666; font-family:monospace" id="clock">00:00</div>
  </div>

  <script>
    const desktop = document.getElementById('desktop');
    const tasksArea = document.getElementById('tasks-area');
    let zIndex = 100;
    let windows = {}; // id -> { el, taskEl }
    let winCount = 0;

    function toggleStart() {
      const menu = document.getElementById('start-menu');
      menu.classList.toggle('open');
    }
    
    // Close start menu if clicked outside
    document.addEventListener('click', (e) => {
      const menu = document.getElementById('start-menu');
      const btn = document.querySelector('.start-btn');
      if (!menu.contains(e.target) && !btn.contains(e.target)) {
        menu.classList.remove('open');
      }
    });

    function updateClock() {
      const now = new Date();
      document.getElementById('clock').textContent = now.toLocaleTimeString();
    }
    setInterval(updateClock, 1000);
    updateClock();

    function openApp(url, title, icon, w, h) {
      document.getElementById('start-menu').classList.remove('open');
      
      const id = 'win-' + (++winCount);
      
      // Window HTML
      const win = document.createElement('div');
      win.className = 'window active';
      win.id = id;
      win.style.width = w + 'px';
      win.style.height = h + 'px';
      win.style.zIndex = ++zIndex;
      
      // Random position slightly offset
      const offset = (winCount % 5) * 30 + 40;
      win.style.top = offset + 'px';
      win.style.left = offset + 'px';

      win.innerHTML = `
        <div class="title-bar">
          <div class="win-title">${icon} ${title}</div>
          <div class="win-controls">
            <button class="win-btn min" title="Minimize"></button>
            <button class="win-btn max" title="Maximize"></button>
            <button class="win-btn close" title="Close"></button>
          </div>
        </div>
        <div class="win-content">
          <div class="drag-overlay"></div>
          <iframe src="${url}"></iframe>
        </div>
      `;

      desktop.appendChild(win);

      // Taskbar Item
      const task = document.createElement('div');
      task.className = 'task-item active';
      task.innerHTML = `${icon} ${title}`;
      task.onclick = () => activateWindow(id);
      tasksArea.appendChild(task);

      windows[id] = { el: win, task: task };

      // Event Listeners
      const closeBtn = win.querySelector('.close');
      closeBtn.onclick = (e) => { e.stopPropagation(); closeWindow(id); };
      
      const minBtn = win.querySelector('.min');
      minBtn.onclick = (e) => { e.stopPropagation(); minimizeWindow(id); };

      const maxBtn = win.querySelector('.max');
      maxBtn.onclick = (e) => { e.stopPropagation(); maximizeWindow(id); };

      win.addEventListener('mousedown', () => activateWindow(id));

      // Drag Logic
      const titleBar = win.querySelector('.title-bar');
      titleBar.addEventListener('mousedown', (e) => startDrag(e, win));

      activateWindow(id);
    }

    function closeWindow(id) {
      if (!windows[id]) return;
      windows[id].el.remove();
      windows[id].task.remove();
      delete windows[id];
    }

    function minimizeWindow(id) {
      const win = windows[id].el;
      win.style.display = 'none';
      windows[id].task.classList.remove('active');
    }

    function maximizeWindow(id) {
      const win = windows[id].el;
      if (win.style.width === '100%' && win.style.height === '100%') {
        // Restore
        win.style.width = win.dataset.prevW || '800px';
        win.style.height = win.dataset.prevH || '600px';
        win.style.top = win.dataset.prevT || '50px';
        win.style.left = win.dataset.prevL || '50px';
      } else {
        // Maximize
        win.dataset.prevW = win.style.width;
        win.dataset.prevH = win.style.height;
        win.dataset.prevT = win.style.top;
        win.dataset.prevL = win.style.left;
        
        win.style.top = '0';
        win.style.left = '0';
        win.style.width = '100%';
        win.style.height = '100%';
      }
    }

    function activateWindow(id) {
      if (!windows[id]) return;
      
      // Bring to front
      windows[id].el.style.zIndex = ++zIndex;
      windows[id].el.style.display = 'flex';
      
      // Update taskbar
      Object.values(windows).forEach(w => {
        w.el.classList.remove('active');
        w.task.classList.remove('active');
      });
      
      windows[id].el.classList.add('active');
      windows[id].task.classList.add('active');
    }

    // Dragging Logic
    let isDragging = false;
    let dragOffset = { x: 0, y: 0 };
    let currentDragWin = null;

    function startDrag(e, win) {
      if(e.target.closest('.win-controls')) return; // ignore buttons
      isDragging = true;
      currentDragWin = win;
      dragOffset.x = e.clientX - win.offsetLeft;
      dragOffset.y = e.clientY - win.offsetTop;
      
      win.classList.add('dragging'); // shows overlay over iframe
      activateWindow(win.id);
      
      document.addEventListener('mousemove', onDrag);
      document.addEventListener('mouseup', stopDrag);
    }

    function onDrag(e) {
      if (!isDragging || !currentDragWin) return;
      e.preventDefault();
      
      let x = e.clientX - dragOffset.x;
      let y = e.clientY - dragOffset.y;
      
      // Bounds check (optional, but good)
      if (y < 0) y = 0;
      
      currentDragWin.style.left = x + 'px';
      currentDragWin.style.top = y + 'px';
    }

    function stopDrag() {
      isDragging = false;
      if (currentDragWin) {
        currentDragWin.classList.remove('dragging');
        currentDragWin = null;
      }
      document.removeEventListener('mousemove', onDrag);
      document.removeEventListener('mouseup', stopDrag);
    }
    
    // Auto-open apps for demo
    window.addEventListener('load', () => {
       // Open SoundMaker and PixelArt by default to show off
       setTimeout(() => openApp('pixelart.html', 'Pixel Art Pro', '‚úèÔ∏è', 900, 700), 100);
       setTimeout(() => openApp('soundmaker.html', 'SoundMaker', 'üéπ', 900, 520), 300);
    });

  </script>
</body>
</html>
